
\chapter{Analytic solutions to a spherical mu-metal shell in multi-pole field}
\lhead{\emph{Analytic solutions to a spherical mu-metal shell in multi-pole field}}

The TUCAN nEDM experiment will be carried out inside the large magnetically shielded room that is roughly 3~m in diameter.  The magnetic environment around the experiment will be challenging because of the closeness of the experiment to the TRIUMF cyclotron, which generates a background field of $\sim 350 - 400$ $\mu$T.
%'which is almost one order of magnitude larger than usual background fields') and the changing environment with iron. 
As a result, it is important to gain an understanding of the magnitude and distribution of the field inside  the bulk of a large mu-metal shield located in such an external field. For the purpose of studying this we derive here analytic solutions of the magnetic field inside the bulk of a spherical mu-metal shield that serves as a model of our MSR in the TRIUMF cyclotron field.  For simplicity, we assume a linear magnetic permeability for the shield.


\section{General solution for an applied zonal field}
In this section we present two different methods for solving this problem.  The first using the equivalent bound surface current and the second is via the magnetic scalar potential.  We also show that the two methods are equivalent, of course.

\subsection{Using Equivalent Bound Surface Currents}

In general, any surface current bound to a sphere, and its resulting magnetic field, can be written in terms of spherical harmonics of order $m$ and degree $l$~\cite{CB1, smythe}. One can show , however, that the resulting equations arising from the boundary conditions on the tangential components of the magnetic field (i.e., $B_\theta$  and $B_\phi$) are independent of the order $m$ of the spherical harmonic. Without loss of generality, then, we can restrict the analysis of spherical shields to zonal surface currents and field only (i.e. $\phi$-independent, $m=0$). This also means that the following results can be applied to cases where tesseral components ($m > 0$) do exist in the fields and currents, which is extremely valuable from the point of view of coil design, where the general spherical harmonics can be used as ``building blocks" to produce a desire magnetic field.

From References.~\cite{CB1, smythe}, the zonal surface current
\begin{equation}\label{i}
\bm{K}=KP_l^1(u)\bm{\hat{\phi}}
\end{equation}
bound to a spherical surface $r=a$ gives rise to the vector potential
\begin{equation}\label{a}
\bm A =\mathcal{K} 
\left \{
  \begin{tabular}{ccc}
  $r^l \bm{\hat{\phi}}$ &  & $r< a$  \\
  $\frac{a^{2l+1}}{r^{l+1}}$ &  & $r> a$ 
  \end{tabular}
 \right.
\end{equation}
where $P_l^1(u)$ is the associated Legendre function of order 1 and degree $l$,  $u=cos\theta$, and the coefficient $\mathcal{K}={\muo K}/{(2l+1)a^{l-1}}$ has units $T/m^{l-1}$.

\fig{Images/sphere_1}{width = 0.8\textwidth}{Spherical shell of inner radius ``a" and outer radius ``b" with a thickness ``t" in the presence of uniform magnetic field (i.e. $l=1$).\label{fig:sphere_ls}}{Spherical shell in a uniform magnetic field}

We consider a spherical mu-metal shield of inner radius $r_1=a$ and outer radius $r_2=b$, and permeability $\mu_r$ centered on the origin and exposed to the general zonal field (\textit{i.e.}
%axisymmetric or $\phi$-independent) 
$m=0$)
of order $l$ %in the presence of an externally applied magnetic field 
as shown in Fig.~\ref{fig:sphere_ls}. The general external magnetic filed can be written as~\cite{CB1, smythe} -
\begin{equation}\label{bo}
\bm{B_o} = G_l r^{l-1} (l+1)[l P_l(u) \bm{\hat{r}} -  P_l^1(u)  \bm{\hat{\theta}} ] 
% \label{BextS}
\end{equation}
where the magnitude $G_l$ is in units of $T/m^{l-1}$.  
The response of the permeable sphere  results in bound surface currents $\mathcal{K}_1$ and $\mathcal{K}_1$ on radius $a$ amd $b$, respectively, that give rise to the following contributions to the net magneti field:
%The magnetic fields arising from Eq.~(\ref{a}) are
\begin{equation}\label{r=R}
%\lim_{r\to R}
\bm B_{\mathcal{K}_1} =
\mathcal{K}_1
\left \{
  \begin{tabular}{ccc}
  $r^{l-1}(l+1)[l P_l(u)\bm{\hat{r}} -  P_l^1(u) \bm{\hat{\theta}} ]$ &  & $r<a$  \\
  $\frac{a^{2l+1}}{r^{l+2}}
l[(l+1) P_l(u) \bm{\hat{r}} +  P_l^1(u)  \bm{\hat{\theta}} ]$ &  & $r>a$  
  \end{tabular}
\right. 
\end{equation}

\begin{equation}\label{r=R+t}
%\lim_{r\to R+t}\bm B =
\bm B_{\mathcal{K}_2} =\mathcal{K}_2
\left \{
  \begin{tabular}{ccc}
  $r^{l-1} (l+1)[l P_l(u)\bm{\hat{r}} -  P_l^1(u)\bm{\hat{\theta}} ]$ &  & $r<b$  \\
  $\frac{b^{2l+1}}{r^{l+2}}l[(l+1) P_l(u)\bm{\hat{r}} +  P_l^1(u) \bm{\hat{\theta}} ]$ &  & $r>b$  
  \end{tabular}
\right.
\end{equation}

As result, using superposition, the net field inside the shield ($\it{i.e.}\;r<a$) is 
\begin{equation}\label{r<R}
%\lim_{r\to R}
\bm B_1 = (\mathcal{K}_1+\mathcal{K}_2+G_l) \, (l+1)\, r^{l-1} \, [l P_l(u) \, \bm{\hat{r}} -  P_l^1(u)  \, \bm{\hat{\theta}} \, .
\end{equation}
%
The net field  within the bulk of the shield (\textit{i.e.} $a<r<b$)  is 
\begin{multline}\label{R<r<R+t}
%\lim_{r\to R<r<R+t}
\bm B_2 = \mathcal{K}_1 \, l\, \frac{a^{2l+1}}{r^{l+2}} \,[(l+1) P_l(u) \, \bm{\hat{r}} +  P_l^1(u)  \, \bm{\hat{\theta}} ] \, \\ +\, (\mathcal{K}_2+G_l) \, (l+1)\, r^{l-1} \, [l P_l(u) \, \bm{\hat{r}} -  P_l^1(u)  \, \bm{\hat{\theta}} ] \, .
\end{multline}
%
Whereas, the net field  outside the shield (\textit{i.e.}, $r>b$) is
\begin{multline}\label{r>R}
%\lim_{r\to r>R+t}\bm 
\bm B_3 =\frac{\mathcal{K}_1a^{2l+1} + \mathcal{K}_2 b^{2l+1} }{r^{l+2}} n [(l+1) P_l(u) \bm{\hat{r}} +  P_l^1(u)  \bm{\hat{\theta}} ]  \\+ G_l (l+1) r^{l-1} [n P_l(u) \bm{\hat{r}} - P_l^1(u)  \bm{\hat{\theta}} ]
\end{multline}

To find \(\mathcal{K}_1\) and \(\mathcal{K}_2\) , we have to apply the boundary condition for the tangential component of the magnetic field \textit{i.e.}
\begin{equation}\label{bk}
\frac{1}{\muo} B_{1\theta}=  \frac{1}{\mu_r} B_{2\theta}  
\end{equation}

Using Eqs.~(\ref{r<R}), and (\ref{R<r<R+t}) in (\ref{bk}):
% $$\(\mu_r B_{1\theta}=\muo B_{2\theta}\)$$

% $$\(\mu_r[(\mathcal{K}_1+\mathcal{K}_2+G_l) \, (l+1)\, r^{l-1}(-  P_l^1(u))\ ]=\muo[\mathcal{K}_1 \, n\, \frac{R^{2l+1}}{r^{l+2}}P_l^1(u) \,  +\, (\mathcal{K}_2+G_l) \, (l+1)\, r^{l-1}( -  P_l^1(u))]\)$$

% \begin{multline*}
% -\mu_r \mathcal{K}_1 r^{l-1}(l+1) P_l^1(u)-\mu_r (\mathcal{K}_2+G_l)r^{l-1}(l+1) P_l^1(u)\\=\muo \mathcal{K}_1 n \frac{R^{2l+1}}{r^{l+2}}P_l^1(u)-\muo (\mathcal{K}_2+G_l)r^{l-1}(l+1) P_l^1(u)
% \end{multline*}

% $$\([\mu_r r^{l-1}(l+1)+\muo n \frac{R^{2l+1}}{r^{l+2}}]P_l^1(u)\mathcal{K}_1+(\mu_r-\muo)r^{l-1}(l+1)P_l^1(u)\mathcal{K}_2=-(\mu_r-\muo)r^{l-1}(l+1)P_l^1(u)G_l\)$$
% Excluding $r^{l-1}(l+1)P_l^1(u)$ from both sides we get,

$$[\mu_r+\muo\frac{l}{l+1}\left(\dfrac{a}{r}\right)^{2l+1}]\mathcal{K}_1 +(\mu_r-\muo)\mathcal{K}_2=-(\mu_r-\muo)G_l$$

At $r=a$ :
\begin{equation}\label{es1}
[\mu_r+\muo\frac{l}{l+1}]\mathcal{K}_1 +(\mu_r-\muo)\mathcal{K}_2=-(\mu_r-\muo)G_l
\end{equation}

Similarly, using Eqs.~(\ref{R<r<R+t}), and (\ref{r>R}) in Eq.~(\ref{bk}):
% $$\(\frac{1}{\mu_r} B_{2\theta}=\frac{1}{\muo} B_{3\theta}\)$$
% $$\muo B_{2\theta}=\mu_r B_{3\theta}$$

% Using eq. , (\ref{R<r<R+t}), (\ref{r>R}) we get,
% \begin{multline*}
% \muo\left[\mathcal{K}_1 n\left(\frac{R^{2l+1}}{r^{l+2}}\right)P_l^1(u)+ (\mathcal{K}_2+G_l)(l+1)r^{l-1}\left(-P_l^1(u)\right)\right]\\= \mu_r\left[\frac{\mathcal{K}_1R^{2l+1} + \mathcal{K}_2 b^{2l+1} }{r^{l+2}}n P_l^1(u) +G_l (l+1) r^{l-1}\left(-  P_l^1(u)\right)\right ]
% \end{multline*}

% \begin{multline*}
% (\mu_r-\muo)n\left(\frac{R^{2l+1}}{r^{l+2}}\right)P_l^1(u)\mathcal{K}_1+\left[\mu_r n\frac{b^{2l+1}}{r^{l+2}}+\muo(l+1)r^{l-1}\right]P_l^1(u)\mathcal{K}_2 \\= (\mu_r-\muo)r^{l-1}(l+1)P_l^1(u)G_l
% \end{multline*}
% Excluding $r^{l-1}(l+1)P_l^1(u)$ from both sides we get,
$$(\mu_r-\muo)\frac{l}{l+1}\left(\dfrac{a}{r}\right)^{2l+1}\mathcal{K}_1+[\mu_r\frac{l}{l+1}\left(\dfrac{b}{r}\right)^{2l+1}+\muo]\mathcal{K}_2=(\mu_r-\muo)G_l$$

At $r=b$ :
\begin{equation}\label{es2}
(\mu_r-\muo)\frac{l}{l+1}\left(\dfrac{a}{b}\right)^{2l+1}\mathcal{K}_1+[\mu_r\frac{l}{l+1}+\muo]\mathcal{K}_2=(\mu_r-\muo)G_l
\end{equation}

From Eq. (\ref{es1}) :
% $$\(\frac{[\mu_r+\muo\frac{l}{l+1}]}{(\mu_r-\muo)}\mathcal{K}_1 +\mathcal{K}_2=-G_l\)$$
\begin{equation}\label{k2}
\mathcal{K}_2=-G_l-\frac{\mu_r(l+1)+\muo l}{(\mu_r-\muo)(l+1)}\mathcal{K}_1
\end{equation}

Adding Eqs.~(\ref{es1}), and (\ref{es2}) and using the value of $\mathcal{K}_2$ from Eq.~(\ref{k2}):
% \begin{multline*}
% \left[\mu_r+\muo\frac{l}{l+1}\right]\mathcal{K}_1 +(\mu_r-\muo)\mathcal{K}_2+(\mu_r-\muo)G_l+(\mu_r-\muo)\frac{l}{l+1}\left(\dfrac{a}{b}\right)^{2l+1}\mathcal{K}_1\\+\left[\mu_r\frac{l}{l+1}+\muo\right]\mathcal{K}_2-(\mu_r-\muo)G_l=0
% \end{multline*}
% \begin{multline*}
% [\mu_r+\muo\frac{l}{l+1}+(\mu_r-\muo)\frac{l}{l+1}\left(\dfrac{a}{b}\right)^{2l+1}]\mathcal{K}_1 +[\mu_r-\muo+\mu_r\frac{l}{l+1}+\muo]\mathcal{K}_2=0
% \end{multline*}
% Multiplying by $(l+1)$ we get,
% \begin{multline*}
% \left[\mu_r(l+1)+\muo{n}+(\mu_r-\muo){n}\left(\dfrac{a}{b}\right)^{2l+1}\right]\mathcal{K}_1 +\mu_r (2l+1)\mathcal{K}_2=0
% \end{multline*}
% Putting the value of \(\mathcal{K}_2\) from Eq.(\ref{k2}) we get,
% \begin{multline*}
% \left[\mu_r(l+1)+\muo{n}+(\mu_r-\muo){n}\left(\dfrac{a}{b}\right)^{2l+1}\right]\mathcal{K}_1 \\+\mu_r (2l+1) \left[-G_l-\frac{\mu_r(l+1)+\muo n}{(\mu_r-\muo)(l+1)}\mathcal{K}_1\right]=0
% \end{multline*}

% \begin{multline*}
% \left[\frac{\mu_r^2 (l+1) (2l+1)+\muo\mu_r n(2l+1)}{(\mu_r-\muo)(l+1)}-\mu_r(l+1)-\muo{n}-(\mu_r-\muo){n}\left(\dfrac{a}{b}\right)^{2l+1}\right]\mathcal{K}_1\\=-\mu_r (2l+1)G_l
% \end{multline*}

% \begin{multline*}
% [\mu_r^2 (l+1) (2l+1)+\muo\mu_r n(2l+1)-\mu_r^2(l+1)^2+\muo\mu_r(l+1)^2-\muo\mu_r n(l+1)
% +\muo^2 n(l+1)\\-(\mu_r-\muo)^2 n(l+1)\left(\dfrac{a}{b}\right)^{2l+1}]\mathcal{K}_1=-\mu_r (\mu_r-\muo)(l+1)(2l+1)G_l
% \end{multline*}


% \begin{multline*}
% [\mu_r^2(2n^2+2n+l+1-n^2-2l-1)+\muo\mu_r (2n^2+n-n^2-n)+\muo\mu_r(l+1)^2+\muo^2 n(l+1)\\-(\mu_r-\muo)^2 n(l+1)\left(\dfrac{a}{b}\right)^{2l+1}]\mathcal{K}_1=-\mu_r(\mu_r-\muo)(l+1) (2l+1)G_l
% \end{multline*}

% \begin{multline*}
% [\mu_r^2 n(l+1)+\muo\mu_r n^2+\muo\mu_r(l+1)^2+\muo^2 n(l+1)-(\mu_r-\muo)^2 n(l+1)\left(\dfrac{a}{b}\right)^{2l+1}]\mathcal{K}_1\\=-\mu_r(\mu_r-\muo)(l+1) (2l+1)G_l
% \end{multline*}

% \begin{multline*}
% [\mu_r n(\mu_r(l+1)+\muo n)+\muo(l+1)(\mu_r(l+1)+\muo n)-(\mu_r-\muo)^2 n(l+1)\left(\dfrac{a}{b}\right)^{2l+1}]\mathcal{K}_1\\=-\mu_r(\mu_r-\muo)(l+1) (2l+1)G_l
% \end{multline*}

\begin{equation}\label{k1}
\mathcal{K}_1=-\frac{\mu_r(\mu_r-\muo)(l+1) (2l+1)G_l}{[\mu_r(l+1)+\muo l)][\mu_r l+\muo(l+1)]-(\mu_r-\muo)^2 l(l+1)\left(\dfrac{a}{b}\right)^{2l+1}}
\end{equation}

\fig{Images/sphere_s}{width = 0.8\textwidth}{Shielding effect of spherical shell in a uniform magnetic field.\label{fig:sphere_s}}{Shielding effect of spherical shell in a uniform magnetic field.}

The net field  within the bulk of the shield (\textit{i.e.}, $a<r<b$) (see Eq.~(\ref{R<r<R+t}))  is 
% \begin{multline*}
% \bm B_2= \left[\mathcal{K}_1 n(l+1)\frac{R^{2l+1}}{r^{l+2}}+(\mathcal{K}_2+G_l)n(l+1) r^{l-1}\right] P_l(u) \bm{\hat{r}}\\ + \left[\mathcal{K}_1 n\frac{R^{2l+1}}{r^{l+2}}-(\mathcal{K}_2+G_l)(l+1) r^{l-1}\right] P_l^1(u) \bm{\hat{\theta}}
% \end{multline*}
\begin{multline}\label{B2}
\bm B= l(l+1)r^{l-1}\left[\mathcal{K}_1 \left(\dfrac{a}{r}\right)^{2l+1}+(\mathcal{K}_2+G_l)\right] P_l(u) \bm{\hat{r}} \\+r^{l-1} \left[\mathcal{K}_1 l\left(\dfrac{a}{r}\right)^{2l+1}-(\mathcal{K}_2+G_l)(l+1) \right] P_l^1(u) \bm{\hat{\theta}}
\end{multline}



Using Eqs.~(\ref{k12}), and (\ref{k22}) in Eq.~(\ref{B2}):
% \begin{align*}
% &\bm B_2= n(l+1)r^{l-1}[\mathcal{K}_1 \left(\dfrac{a}{r}\right)^{2l+1}-\mathcal{K}_1] P_l(u) \bm{\hat{r}} +r^{l-1} [\mathcal{K}_1 n\left(\dfrac{a}{r}\right)^{2l+1}+\mathcal{K}_1(l+1) ] P_l^1(u) \bm{\hat{\theta}}\\
% &\bm B_2= n(l+1)r^{l-1}\mathcal{K}_1[\left(\dfrac{a}{r}\right)^{2l+1}-1] P_l(u) \bm{\hat{r}} +r^{l-1} \mathcal{K}_1[n\left(\dfrac{a}{r}\right)^{2l+1}+(l+1) ] P_l^1(u) \bm{\hat{\theta}}
% \end{align*}


% Now, using eq. (\ref{k12}) we get,
% \begin{multline*}
% \bm B_2= -n(l+1)r^{l-1}\left[-\frac{(2l+1)G_l}{n-n\left(\dfrac{a}{b}\right)^{2l+1}}][1-\left(\dfrac{a}{r}\right)^{2l+1}\right] P_l(u) \bm{\hat{r}} \\+r^{l-1} \left[-\frac{(2l+1)G_l}{n-n\left(\dfrac{a}{b}\right)^{2l+1}}\right]\left[(l+1)+n\left(\dfrac{a}{r}\right)^{2l+1}\right] P_l^1(u) \bm{\hat{\theta}}
% \end{multline*}
% \begin{multline*}
% \bm B_2= (l+1)(2l+1)r^{l-1}G_l\left[\frac{1-\left(\dfrac{a}{r}\right)^{2l+1}}{1-\left(\dfrac{a}{b}\right)^{2l+1}}\right] P_l(u) \bm{\hat{r}} \\-(2l+1)r^{l-1}G_l\left [\frac{\frac{l+1}{n}+\left(\dfrac{a}{r}\right)^{2l+1}}{1-\left(\dfrac{a}{b}\right)^{2l+1}}\right] P_l^1(u) \bm{\hat{\theta}}
% \end{multline*}
% \begin{multline*}
% \bm B_2= (l+1)(2l+1)r^{l-1}G_l\left[\frac{1-\left(\dfrac{a}{r}\right)^{2l+1}}{1-\left(\dfrac{a}{b}\right)^{2l+1}}\right] P_l(u) \bm{\hat{r}} \\-\frac{(2l+1)}{n}(l+1)r^{l-1}G_l \left[\frac{1+\frac{l}{l+1}\left(\dfrac{a}{r}\right)^{2l+1}}{1-\left(\dfrac{a}{b}\right)^{2l+1}}\right] P_l^1(u) \bm{\hat{\theta}}
% \end{multline*}

% Therefore,

$$\bm B= (l+1)(2l+1)r^{l-1}G_l\left[\left[\frac{1-\left(\dfrac{a}{r}\right)^{2l+1}}{1-\left(\dfrac{a}{b}\right)^{2l+1}}\right] P_l(u) \bm{\hat{r}} -\frac{1}{n}\left[\frac{1+\frac{l}{l+1}\left(\dfrac{a}{r}\right)^{2l+1}}{1-\left(\dfrac{a}{b}\right)^{2l+1}}\right] P_l^1(u) \bm{\hat{\theta}}\right]$$



\subsection{Using Scalar Potential}
The magnetic field calculation using scalar potential due to presence of a spherical mu-metal shield in a uniform magnetic field \(\bm{B_o}= \muo \bm H_o\) has been discussed in Section~\textcolor{blue}{5.12} of Ref.~\cite{jackson}. We will extend the derivation of that Section to find out the magnetic field inside the bulk of a spherical mu-metal shield and compare with the bound surface current method discussed in previous Section considering the same mu-metal as shown in Fig.~\ref{fig:sphere_ls}.
% \fig{Images/sphere_1}{width = \textwidth}{Spherical shell in a uniform magnetic field.\label{fig:sphere_ls}}{Spherical shell in a uniform magnetic field.}

% Fig.~\ref{fig:sphere_ls} shows an example of placing a spherical shell of thickness t in a uniform magnetic field, $\bm B_o$. The shell is made of material of permeability $\mu_r$.

Ampere's law relates the magnetic field $\bm{H}$ to the current density $\bm{J}$ as \(\bm{\nabla}\times\bm{H}=\bm{J}\). As there is no free currents presents $\it{i.e.}$ \(\bm{J}_f=\bm{K}_f=0\) , so \(\bm{\nabla}\times\bm{H}=0\) everywhere. It implies that there exists a magnetic scalar potential \(\Phi\) that is continuous  everywhere and the  magnetic field $\bm{H}$ is derivable as -
\begin{equation}\label{H}
\bm{H}=-\bm{\nabla}\Phi
\end{equation} 

According to Maxwell's equation, the magnetic field $\bm{B}$ has divergence equal to zero $\it{i.e.}$ \(\bm{\nabla}\cdot\bm{B}=0\). Since \(\bm{B}=\mu_r\bm{H}\), magnetic field $\bm{H}$ also has divergence equal to zero $\it{i.e.}$
\begin{equation}\label{nablaH}
\bm{\nabla}\cdot\bm{H}=0
\end{equation}

Using Eq.~(\ref{H}) in Eq.~(\ref{nablaH}) :
\begin{equation}
\bm{\nabla}\cdot\bm{H}=\bm{\nabla^2}\Phi=0
\end{equation}


So, $\Phi$ satisfies the Laplace equation.  In spherical co-ordinates ($r, \theta, \phi$), it is -

\begin{equation}
\nabla^2 \Phi=\frac{1}{r^2}\left[\frac{\partial }{\partial r} \left(r^2\frac{\partial \Phi}{\partial r}\right) \right]+ \frac{1}{r^2 \sin\theta}\left[\frac{\partial }{\partial \theta} \left(\sin\theta\frac{\partial \Phi}{\partial \theta}\right) \right]+ \frac{1}{r^2 \sin^2\theta}\frac{\partial^2 \Phi}{\partial \phi^2}
\end{equation}

The general solution is -
\begin{equation}
\Phi(r,\theta, \phi)=\sum_{l=0}^{\infty}\sum_{m=-l}^l [A_{lm}r^l+B_{lm}r^{-(l+1)}]Y_{lm}(\theta, \phi)
\end{equation}

For physical situations with complete rotational symmetry about the $z$-axis $\it{i.e.}$ azimuthal symmetry, the general solution $\Phi$ is independent of $\phi$ $\it{i.e.}\;m=0$. Then the solution will be reduced to -
\begin{equation}
\Phi(r,\theta)=\sum_{l=0}^{\infty} [A_lr^l+B_lr^{-(l+1)}]P_l(\cos\theta)
\end{equation}
The co-coefficients $A_l$ and $B_l$ are determined by the following boundary conditions at $r=a$, and $r=b$.
\begin{equation}\label{b1}   
\bm{H}_2\times \bm{n} = \bm{H}_1\times \bm{n}  
\end{equation}

\begin{equation}\label{b2}   
\bm{H}_2\cdot \bm{n}=\frac{\mu_{1}}{\mu_{2}}\bm{H}_1\cdot \bm{n}
\end{equation}


To give the uniform field, $\bm{H}=\bm{H}_o$, at large distances, $\Phi$ must be

\begin{align}
    \Phi_1=-Hr^lP_l(\cos\theta)+\sum_{l=0}^{\infty}\frac{\alpha}{r^{l+1}}P_l(\cos\theta)\;\;\;\;\;\;\;r>b \label{r>b} \\
    \Phi_2=\sum_{l=0}^{\infty} \left(\beta r^l+\frac{\gamma}{r^{l+1}}\right)P_l(\cos\theta)\;\;\;\;\;\;\;\;\;\;\;\;a<r<b \label{a<r<b} \\
    \Phi_3=\sum_{l=0}^{\infty} \delta r^l P_l(\cos\theta)\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;r<a \label{r<a} 
\end{align}


Using Eq.~(\ref{H}) and the boundary condition from Eq.~(\ref{b1}) at $r=b$ :

% The boundary conditions at $r=a$, and $r=b$ are that $H_\theta$ and $B_r$ be continuous
$$\frac{\partial \Phi_3}{\partial \theta}(b)=\frac{\partial \Phi_2}{\partial \theta}(b)$$

Using the values from Eqs.~(\ref{r>b}), and (\ref{a<r<b}) :
% $$-Hb^l\frac{\delta}{\delta \theta}(P_l(\cos\theta))+\frac{\alpha}{r^{l+1}}\frac{\delta}{\delta \theta}(P_l(\cos\theta))=\left(\beta b^l+\frac{\gamma}{b^{l+1}}\right)\frac{\delta}{\delta \theta}(P_l(\cos\theta))$$
\begin{equation}\label{e01}
-Hb^l+\frac{\alpha}{b^{l+1}}=\beta b^l+\frac{\gamma}{b^{l+1}}
\end{equation}

Using Eq.~(\ref{H}) and the boundary condition from Eq.~(\ref{b1}) at $r=a$ :

$$\frac{\partial \Phi_2}{\partial \theta}(a)=\frac{\partial \Phi_1}{\partial \theta}(a)$$

Using Eqs.~(\ref{a<r<b}), and (\ref{r<a}):
% $$\left(\beta a^l+\frac{\gamma}{a^{l+1}}\right)\frac{\delta}{\delta \theta}(P_l(\cos\theta))=\delta a^l \frac{\delta}{\delta \theta}(P_l(\cos\theta))$$
\begin{equation}\label{e02}
\beta a^l+\frac{\gamma}{a^{l+1}}=\delta a^l
\end{equation}

Using Eq.~(\ref{H}) and the boundary condition from Eq.~(\ref{b2}) at $r=b$ :

$$\muo\frac{\partial \Phi_3}{\partial r}(b)=\mu_r\frac{\partial \Phi_2}{\partial r}(b)$$

Using Eqs.~(\ref{r>b}), and (\ref{a<r<b}):
% $$\muo\left[-Hlb^{l-1}+\frac{-(l+1)\alpha}{b^{l+2}}\right]P_l(\cos\theta)=\mu_r\left[\beta l b^{l-1}+\frac{-(l+1)\gamma}{b^{l+2}}\right]P_l(\cos\theta)$$
\begin{equation}\label{e03}
-Hlb^{l-1}-\frac{(l+1)\alpha}{b^{l+2}}=\frac{\mu_r}{\muo}\left[\beta l b^{l-1}-\frac{(l+1)\gamma}{b^{l+2}}\right]
\end{equation}

Using Eq.~(\ref{H}) and the boundary condition from Eq.~(\ref{b2}) at $r=a$ :

$$\mu_r\frac{\partial \Phi_2}{\partial r}(a)=\muo\frac{\partial \Phi_1}{\partial r}(a)$$

Using Eqs.~(\ref{a<r<b}), and (\ref{r<a}):
% $$\frac{\mu_r}{\muo}\left[\beta l a^{l-1}+\frac{-(l+1)\gamma}{a^{l+2}}\right]P_l(\cos\theta)=\delta l a^{l-1} P_l(\cos\theta)$$
\begin{equation}\label{e04}
\delta l a^{l-1}=\mu_r'\left[\beta l a^{l-1}-\frac{(l+1)\gamma}{a^{l+2}}\right]
\end{equation}

% Eq.~(\ref{e01}) can be reduced to -
% % $$-Hb^l+\frac{\alpha}{b^{l+1}}=\beta b^l+\frac{\gamma}{b^{l+1}}$$
% % $$\frac{-Hb^{2l+1}+\alpha}{b^{l+1}}=\frac{\beta b^{2l+1}+\gamma}{b^{l+1}}$$
% % $$-Hb^{2l+1}+\alpha=\beta b^{2l+1}+\gamma$$
% \begin{equation}
% \alpha- b^{2l+1}\beta-\gamma=b^{2l+1}H
% \end{equation}

% Eq.[\ref{e02}] can be reduced to -
% % $$\beta a^l+\frac{\gamma}{a^{l+1}}=\delta a^l$$
% % $$\frac{\beta a^{2l+1}+\gamma}{a^{l+1}}=\delta a^l$$
% \begin{equation}
%  a^{2l+1}\beta+\gamma-a^{2l+1}\delta =0
% \end{equation}

% Eq.~(\ref{e03}) can be reduced to -
% % $$-Hlb^{l-1}-\frac{(l+1)\alpha}{b^{l+2}}=\mu_r'\left[\beta l b^{l-1}-\frac{(l+1)\gamma}{b^{l+2}}\right]$$
% % $$\frac{-Hlb^{2l+1}-(l+1)\alpha}{b^{l+2}}=\mu_r'\left[\frac{\beta l b^{2l+1}-(l+1)\gamma}{b^{l+2}}\right]$$
% \begin{equation}
% (l+1)\alpha+\mu_r' l b^{2l+1}\beta-\mu_r'(l+1)\gamma=-lb^{2l+1}H
% \end{equation}

% Eq.~(\ref{e04}) can be reduced to -
% % $$\delta l a^{l-1}=\mu_r'\left[\beta l a^{l-1}-\frac{(l+1)\gamma}{a^{l+2}}\right]$$
% % $$\delta l a^{l-1}=\mu_r'\left[\frac{\beta l a^{2l+1}-(l+1)\gamma}{a^{l+2}}\right]$$
% % $$\delta l a^{2l+1}=\mu_r'\beta l a^{2l+1}-\mu_r'(l+1)\gamma$$
% \begin{equation}
% \mu_r'l a^{2l+1}\beta -\mu_r'(l+1)\gamma- l a^{2l+1}\delta=0
% \end{equation}

Eqs.~(\ref{e01}),~(\ref{e02}),~(\ref{e03}), and ~(\ref{e04}) can be reduced to -
\begin{equation}\label{e1}
\alpha- b^{2l+1}\beta-\gamma=b^{2l+1}H
\end{equation}
\begin{equation}\label{e2}
 a^{2l+1}\beta+\gamma-a^{2l+1}\delta =0
\end{equation}
\begin{equation}\label{e3}
(l+1)\alpha+\mu_r' l b^{2l+1}\beta-\mu_r'(l+1)\gamma=-lb^{2l+1}H
\end{equation}
\begin{equation}\label{e4}
\mu_r'l a^{2l+1}\beta -\mu_r'(l+1)\gamma- l a^{2l+1}\delta=0
\end{equation}

Subtracting Eq.~(\ref{e2}) from Eq.(\ref{e4})/$l$ -
% $$\mu_r' a^{2l+1}\beta -\left(\frac{l+1}{l}\right)\mu_r'\gamma- a^{2l+1}\delta-a^{2l+1}\beta-\gamma+a^{2l+1}\delta=0$$
% $$ \beta a^{2l+1}(\mu_r'-1) -\gamma\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]=0$$
% So we get,
\begin{equation}\label{g1}
\gamma=\beta \left[\frac{a^{2l+1}(\mu_r'-1)}{\left(\frac{l+1}{l}\right)\mu_r'+1}\right]
\end{equation}

Subtracting Eq.~(\ref{e1})$*(l+1)$ from Eq.~(\ref{e3}) and using the value of Eq.(\ref{g1})
% $$(l+1)\alpha+\mu_r' l b^{2l+1}\beta-\mu_r'(l+1)\gamma+lb^{2l+1}H-(l+1)\alpha+(l+1) b^{2l+1}\beta+(l+1)\gamma+(l+1)b^{2l+1}H$$
% $$(\mu_r'l+l+1) b^{2l+1}\beta+(1-\mu_r')(l+1)\gamma=-(l+1+l)b^{2l+1}H$$
% Putting the value of eq.[\ref{g1}] we get,
% $$(\mu_r'l+l+1) b^{2l+1}\beta+(l+1)a^{2l+1}\beta \left[\frac{(1-\mu_r')(\mu_r'-1)}{\left(\frac{l+1}{l}\right)\mu_r'+1}\right]=-(2l+1)b^{2l+1}H$$
% $$\beta(\mu_r'l+l+1) -\beta(l+1)\left(\frac{a}{b}\right)^{2l+1} \left[\frac{(\mu_r'-1)^2}{\left(\frac{l+1}{l}\right)\mu_r'+1}\right]=-(2l+1)H$$
% $$\beta\left[(\mu_r'l+l+1) -(l+1)\left(\frac{a}{b}\right)^{2l+1} \left[\frac{(\mu_r'-1)^2}{\left(\frac{l+1}{l}\right)\mu_r'+1}\right]\right]=-(2l+1)H$$
% $$\beta\left[\frac{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}{\left(\frac{l+1}{l}\right)\mu_r'+1}\right]=-(2l+1)H$$
% So we get,
\begin{equation}\label{bt1}
\beta=-\left[\frac{(2l+1)\left(\left(\frac{l+1}{l}\right)\mu_r'+1\right)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H
\end{equation}

% For $\mu_r\gg\muo \Rightarrow \mu_r/\muo\gg 1 \Rightarrow \mu_r'\gg 1$ -
% % $$\beta\approx-\left[\frac{\left[\frac{(2l+1)(l+1)}{l}\right]\mu_r'}{(l+1)\mu_r'^2-(l+1)\left(\frac{a}{b}\right)^{2l+1}\mu_r'^2}\right]H$$
% % $$\beta\approx-\left[\frac{(2l+1)(l+1)\mu_r'}{l(l+1)\mu_r'^2\left[1-\left(\frac{a}{b}\right)^{2l+1}}\right]\right]H$$
% % So we get,

% \begin{equation}\label{bt2}
% \beta\approx-\left[\frac{(2l+1)\muo}{l\mu_r\left[1-\left(\frac{a}{b}\right)^{2l+1}\right]\right]H
% \end{equation}

Putting the value of Eq.~(\ref{bt1}) in Eq.~(\ref{g1}):
% $$\gamma=-\left[\frac{(2l+1)\left(\left(\frac{l+1}{l}\right)\mu_r'+1\right)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right] \left[\frac{a^{2l+1}(\mu_r'-1)}{\left(\frac{l+1}{l}\right)\mu_r'+1}\right]H$$
\begin{equation}\label{g2}
\gamma=-\left[\frac{(2l+1)a^{2l+1}(\mu_r'-1)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right] H    
\end{equation}


% For \(\mu_r'\gg 1\) :
% % $$\gamma\approx-\left[\frac{(2l+1)a^{2l+1}\mu_r'}{\mu_r'^2(l+1)-(l+1)\left(\frac{a}{b}\right)^{2l+1}\mu_r'^2}\right] H$$
% % $$\gamma\approx-\left[\frac{(2l+1)a^{2l+1}\mu_r'}{\mu_r'^2(l+1)\left(1-\left(\frac{a}{b}\right)^{2l+1}\right)}\right] H$$
% % So, we get,
% \begin{equation}\label{g2}
% \gamma\approx-\left[\frac{(2l+1)a^{2l+1}\muo}{\mu_r(l+1)\left(1-\left(\frac{a}{b}\right)^{2l+1}\right)}\right] H
% \end{equation}
Using Eqs.~(\ref{g2}), and (\ref{bt1}) in Eq.~(\ref{e2}) we get,
% $$\delta =\beta+\frac{\gamma}{a^{2l+1}}$$
% $$\delta =-\left[\frac{1}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]$$ $$\left[(2l+1)\left(\left(\frac{l+1}{l}\right)\mu_r'+1\right)+(2l+1)(\mu_r'-1)\right]H$$
% $$\delta =-\left[\frac{(2l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1+\mu_r'-1\right]}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H$$
% $$\delta =-\left[\frac{(2l+1)\left[\mu_r'\left(\frac{l+1}{l}+1\right)\right]}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H$$
% So we get,
\begin{equation}\label{dt1}
\delta =-\left[\frac{\frac{(2l+1)^2}{l}\mu_r'}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H    
\end{equation}


% Therefore,

% \begin{equation}\label{bt1}
% \beta=-\left[\frac{(2l+1)\left(\left(\frac{l+1}{l}\right)\mu_r'+1\right)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H
% \end{equation}
% \begin{equation}\label{g1}
% \gamma=-\left[\frac{(2l+1)a^{2l+1}(\mu_r'-1)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right] H    
% \end{equation}
% \begin{equation}\label{dt1}
% \delta =-\left[\frac{\frac{(2l+1)^2}{l}\mu_r'}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H    
% \end{equation}



For \(a\textless r\textless b \) from Eq.~(\ref{a<r<b}) :



% $$\Phi=\left(\beta r^l+\frac{\gamma}{r^{l+1}}\right)P_l(\cos\theta)$$
% $$\Phi=\left[-r^l\left[\frac{(2l+1)\muo}{l\mu_r\left[1-\left(\frac{a}{b}\right)^{2l+1}}\right]\right]H-\frac{r^l}{r^{2l+1}}\left[\frac{(2l+1)a^{2l+1}\muo}{\mu_r(l+1)\left(1-\left(\frac{a}{b}\right)^{2l+1}\right)}\right] H}\right]P_l(\cos\theta)$$
% $$\Phi=-\frac{(2l+1)Hr^lP_l(\cos\theta)}{\mu_r\left[1-\left(\frac{a}{b}\right)^{2l+1}}\right]}\left[\frac{\muo}{l}+\left(\frac{a}{r}\right)^{2l+1}\left(\frac{\muo}{l+1}\right)\right]$$
% $$\Phi=-\frac{(2l+1)(\muo H)r^lP_l(\cos\theta)}{\mu_r(l+1)}\left[\frac{\frac{l+1}{l}+\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]$$
% $$\Phi=-\frac{(2l+1)Br^lP_l(\cos\theta)}{\mu_r(l+1)}\left[\frac{\frac{l+1}{l}+\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]$$
\begin{equation}\label{p}
\Phi=-\frac{(2l+1)Br^lP_l(\cos\theta)}{\mu_r l}\left[\frac{1+\frac{l}{l+1}\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]
\end{equation}
% From Eq.[\ref{H}] we know,
% $$\bm{H}=-\bm{\nabla}\Phi$$
% $$H_r=-\frac{\delta \Phi}{\delta r}$$
Using Eq.~(\ref{H}) in Eq.~(\ref{p}) :
% $$H_r=-\frac{\delta}{\delta r}\left[-\frac{(2l+1)Br^lP_l(\cos\theta)}{\mu_r l}\left[\frac{1+\frac{l}{l+1}\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]\right]$$
% $$H_r=\frac{(2l+1)BP_l(u)}{\mu_r l\left[1-\left(\frac{a}{b}\right)^{2l+1}\right]}\frac{\delta}{\delta r}\left[r^l+\frac{l}{l+1}a^{2l+1}r^{-2l-1+l}\right]$$
% $$H_r=\frac{(2l+1)BP_l(u)}{\mu_r l\left[1-\left(\frac{a}{b}\right)^{2l+1}\right]}\left[l r^{l-1}+\frac{l}{l+1}a^{2l+1}\frac{(-l-1)}{r^{l+2}}\right]$$
% $$H_r=\frac{(2l+1)BP_l(u)l r^{l-1}}{\mu_r l\left[1-\left(\frac{a}{b}\right)^{2l+1}\right]}\left[1-\left(\frac{a}{r}\right)^{2l+1}\right]$$
% So we get,
\begin{equation}\label{Hr}
\begin{split}
    H_r &=-\frac{\partial \Phi}{\partial r}\\
      &=\frac{(2l+1)}{\mu_r}r^{l-1}BP_l(u)\left[\frac{1-\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]
\end{split}
\end{equation}
Therefore,
\begin{equation}\label{Br}
B_r=(2l+1)r^{l-1}BP_l(u)\left[\frac{1-\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]
\end{equation}

Similarly,
% \begin{equation*}
% \begin{split}
% H_\theta &=-\frac{1}{r}\frac{\delta \Phi}{\delta \theta}\\
%         & =-\frac{1}{r}\frac{\delta}{\delta \theta}\left[-\frac{(2l+1)Br^lP_l(\cos\theta)}{\mu_r l}\left[\frac{1+\frac{l}{l+1}\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]\right]
% \end{split}
% \end{equation*}

% So we get,
\begin{equation}\label{Ht}
\begin{split}
 H_\theta &=-\frac{1}{r}\frac{\partial \Phi}{\partial \theta}\\
         & =-\frac{(2l+1)}{\mu_rl}Br^{l-1}P_l^1(u)\left[
         \frac{1+\frac{l}{l+1}\left(\frac{a}{r}\right)^{2l+1}}
         {1-\left(\frac{a}{b}\right)^{2l+1}}
         \right]
\end{split}
\end{equation}

Therefore,
\begin{equation}\label{Bt}
B_\theta=-\frac{(2l+1)}{l}Br^{l-1}P_l^1(u)\left[\frac{1+\frac{l}{l+1}\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right]
\end{equation}

Finally, the magnetic field inside the bulk of a spherical mu-metal shield is
\begin{multline}\label{B}
\bm{B}=(2l+1)r^{l-1}B_o P_l(u)\left[\frac{1-\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right] \hat{r} \\ -\frac{(2l+1)}{l}B_o r^{l-1}P_l^1(u)\left[\frac{1+\frac{l}{l+1}\left(\frac{a}{r}\right)^{2l+1}}{1-\left(\frac{a}{b}\right)^{2l+1}}\right] \hat{\theta}
\end{multline}


\subsection{Comparison of two methods}
For comparing two methods discussed in previous Sections, the following boundary conditions should satisfy

\begin{equation}\label{b3}   
(\mu_2\bm{H_2} - \mu_1\bm{H_1})\times n = \muo \bm{K}  
\end{equation}

Using Eq.~(\ref{H}) and the boundary condition from Eq.~(\ref{b3}) at $r=a$ :
% $$-\mu_r \frac{1}{r}\frac{\delta \Phi_2}{\delta \theta}(a)+\muo \frac{1}{r}\frac{\delta \Phi_1}{\delta \theta}(a)=\muo\bm{K_1}  $$
$$\frac{1}{r}\frac{\partial \Phi_1}{\partial \theta}(a)-\frac{1}{r}\mu'_r\frac{\partial \Phi_2}{\partial \theta}(a)=\bm{K_1}  $$

Using Eqs.~(\ref{a<r<b}), and (\ref{r<a})
$$\frac{1}{a}\left[\delta a^l-\mu'_r\left(\beta a^l+\frac{\gamma}{a^{l+1}}\right)\right]\frac{\partial}{\partial \theta}(P_l(\cos\theta))= \bm{K_1}$$
$$\frac{1}{a}\left[\delta a^l-\mu'_r\left(\beta a^l+\frac{\gamma}{a^{l+1}}\right)\right][-P_l^1(u)]= K_1 P_l^1(u)$$
$$a K_1=\mu'_r\left(\beta a^l+\frac{\gamma}{a^{l+1}}\right)-\delta a^l$$
$$\frac{(2l+1)a^{l-1+1}\mathcal{K}_1}{\muo}=\mu'_r\left(\beta a^l+\frac{\gamma}{a^{l+1}}\right)-\delta a^l$$
$$\frac{(2l+1)a^l\mathcal{K}_1}{\muo}=a^l\left[\mu'_r\left(\beta +\frac{\gamma}{a^{2l+1}}\right)-\delta \right]$$
Using Eq.~(\ref{bt1}), (\ref{g2}), and (\ref{dt1}):
% $$\frac{(2l+1)\mathcal{K}_1}{\muo}=-\left[\frac{2l+1}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]$$ $$\left[\mu'_r\left(\left(\frac{l+1}{l}\right)\mu_r'+1+\mu_r'-1\right)-\frac{(2l+1)}{l}\mu_r'}\right]H$$
% $$\frac{\mathcal{K}_1}{\muo}=-\left[\frac{\mu'_r\left(\left(\frac{l+1}{l}\right)\mu_r'+\mu_r'-\frac{2l+1}{l}\right)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H$$
% $$\frac{\mathcal{K}_1}{\muo}=-\left[\frac{\mu'_r\left(\frac{\mu_r'l+\mu_r'+\mu_r'l-2l-1}{l}\right)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H$$
% $$\frac{\mathcal{K}_1}{\muo}=-\frac{1}{l}\left[\frac{\mu'_r\left(\mu_r'(2l+1)-1(2l+1)\right)}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]H$$
% So we get,
\begin{equation}\label{k1s}
\mathcal{K}_1=-\frac{\muo H}{l}\left[\frac{(2l+1)(\mu_r'-1)\mu'_r}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]
\end{equation}
Eq.~(\ref{k1}) can be written as
% $$\mathcal{K}_1=-\frac{G_l(2l+1)(l+1)(\mu_r-\muo)\mu_r}{[\mu_r(l+1)+\muo l)][\mu_r l+\muo(l+1)]-l(l+1)\left(\dfrac{a}{b}\right)^{2l+1}(\mu_r-\muo)^2}$$
% $$\mathcal{K}_1=-\frac{G_l(2l+1)(l+1)(\mu_r'-1)\muo\mu_r}{[\muo(\mu_r' l+\mu_r'+ l)\muo(\mu_r' l+l+1)]-l(l+1)\left(\dfrac{a}{b}\right)^{2l+1}\muo^2(\mu_r'-1)^2}$$
% $$\mathcal{K}_1=-\frac{G_l(2l+1)(l+1)(\mu_r'-1)\mu_r'}{[(\mu_r' l+\mu_r'+ l)l(\mu_r'( 1+\frac{1}{l})+1)]-l(l+1)\left(\dfrac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}$$
% So we get,
\begin{equation}\label{k1b}
\mathcal{K}_1=-\frac{G_l (l+1)}{l}\left[\frac{(2l+1)(\mu_r'-1)\mu'_r}{(\mu_r'l+l+1)\left[\left(\frac{l+1}{l}\right)\mu_r'+1\right]-(l+1)\left(\frac{a}{b}\right)^{2l+1}(\mu_r'-1)^2}\right]
\end{equation}

Comparing Eqs.~(\ref{k1s}), and (\ref{k1b})
\begin{equation}\label{g}
G_l(l+1)=\muo H
\end{equation}

So, if Eq.~(\ref{g}) is correct, then we are getting same result using scalar potential as we got from bound surface current method for $\mathcal{K}_1$.

\subsection{Magnetic field with uniform background (l=1)}

For \(\mu_r\gg\muo\) in Eq.(\ref{k1}):
\begin{equation}\label{k12}
\begin{split}
\mathcal{K}_1\rightarrow\mathcal{K}_1^\infty & =-\frac{\mu_r^2(l+1) (2l+1)G_l}{\mu_r^2 l(l+1)-\mu_r^2 l(l+1)\left(\dfrac{a}{b}\right)^{2l+1}}\\
& =-\frac{3 G_1}{1-\left(\dfrac{a}{b}\right)^{3}}
\end{split}
\end{equation}

For \(\mu_r\gg\muo\) in Eq.(\ref{k2}):
% $$\(\mathcal{K}_2^\infty=-G_l-\frac{\mu_r(l+1)}{\mu_r(l+1}\mathcal{K}_1^\infty\)$$
% $$\(\mathcal{K}_2^\infty=-G_l-\mathcal{K}_1^\infty\)$$
\begin{equation}\label{k22}
\mathcal{K}_2\rightarrow\mathcal{K}_2^\infty=-G_l-\mathcal{K}_1^\infty
\end{equation}

Using Eqs.~(\ref{k12}), and (\ref{k22}) in Eq.~(\ref{B2}):
\begin{equation}
    \bm{B}=6 G_1\frac{1-\left(\frac{a}{r}\right)^3}{1-\left(\frac{a}{b}\right)^3}\cos\theta\;\bm{\hat{r}}-3 G_1\frac{2+\left(\frac{a}{r}\right)^3}{1-\left(\frac{a}{b}\right)^3}\sin\theta\;\bm{\hat{\theta}}
\end{equation}

At $\theta=0$ :
\begin{equation}
    \bm{B}=3\;B_o\;\frac{1-\left(\frac{a}{r}\right)^3}{1-\left(\frac{a}{b}\right)^3}\bm{\hat{z}}
\end{equation}

At $\theta=\pi/2$ :
\begin{equation}
    \bm{B}=\frac{3}{2}\;B_o\;\frac{2+\left(\frac{a}{r}\right)^3}{1-\left(\frac{a}{b}\right)^3}\bm{\hat{z}}\approx \frac{3}{2}\;B_o\frac{a}{t}\bm{\hat{z}}
\end{equation}

\subsection{Comparison with simulation}
\fig{Images/Contour}{width = \textwidth}{Color map of the spherical mu-metal shield in OPERA.\label{fig:sphere_contour}}{Color map of the spherical mu-metal shield in OPERA.}

\begin{table} [!htb]
    \centering
    \begin{tabular} { |c|c|c|c|c|c|} 
        \hline
        Parameters & Sphere \\
        \hline\hline
        Inner Radius, a (m) & 1.296\\ 
        \hline
        Outer Radius, b (m) & 1.3 \\ 
        \hline
        Thickness, t (mm) & 4 \\ 
        \hline
        $\mu_r$  & 20,000 \\ 
        \hline

    \end{tabular}
    % \vspace{4mm}
    \caption{Properties of the spherical mu-metal shield in OPERA.}\label{tablE:opera_sphere}
\end{table}

\begin{table} [!htb]
    \centering
    \begin{tabular} { |c|c|c|c|c|c|} 
        \hline
        Positions (m) & Simulated $\bm{B}$ ($\mu$T) & Analytical $\bm{B}$ ($\mu$T)\\
        \hline\hline
        $x=1.298$, $y=0.0$, and $z=0.0$ & 192,000 & 195,000\\ 
        \hline
        $x=0.0$, $y=1.298$, and $z=0.0$ & 537 & 602\\ 
        \hline
        $x=0.0$, $y=0.0$, and $z=1.298$ & 192,000 & 195,000\\ 
        \hline
        $x=0.0$, $y=1.3$, and $z=0.0$ & 1,120 & 1,200\\ 
        \hline

    \end{tabular}
    % \vspace{4mm}
    \caption[Comparison of simulated $\bm{B}$ field with analytical one ]{Comparison of simulated $\bm{B}$ field with analytical one for a 400 $\mu$T applied field in $y$-direction.}\label{tablE:opera_analytical}
\end{table}

\section{Uniform internal field generation}
From ~\cite{ smythe}, the field in the region $r< a$ for a current loop at \(\theta=\alpha\) is,
\begin{equation}\label{bbr}
B_r=\frac{\muo I \sin \alpha}{2a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1(\cos\alpha) P_l(\cos\theta)
\end{equation}
\begin{equation}\label{bbt}
B_\theta=-\frac{\muo I \sin \alpha}{2a}\sum_{n=1}^{\infty} \frac{1}{n}\left(\frac{r}{a}\right)^{l-1}P_l^1(\cos\alpha) P_l^1(\cos\theta)
\end{equation}

For Helmholtz coils of radius \(r_c\) located at \(z=\pm z_o\) i.e. for two loops at \(\theta=\alpha, \pi-\alpha \), \(I_2=I_1=I\) and \(z_o=\frac{r_c}{2}\),
\begin{equation}\label{sinH}
\sin\alpha=\frac{r_c}{a}=\frac{r_c}{\sqrt{z_o^2+r_c^2}}=\frac{r_c}{\sqrt{\left(\frac{r_c}{2}\right)^2+r_c^2}}=\frac{r_c}{\sqrt{\frac{5r_c^2}{4}}}=\frac{2}{\sqrt{5}}
\end{equation}
\begin{equation}\label{sinHb}
\sin(\pi-\alpha)=\sin\pi\cos\alpha-\cos\pi\sin\alpha=\sin\alpha=\frac{2}{\sqrt{5}}
\end{equation}

\begin{equation}\label{cosH}
\cos\alpha=\frac{z_o}{a}=\frac{r_c}{2\sqrt{z_o^2+r_c^2}}=\frac{r_c}{2\sqrt{\left(\frac{r_c}{2}\right)^2+r_c^2}}=\frac{r_c}{2\sqrt{\frac{5r_c^2}{4}}}=\frac{1}{\sqrt{5}}
\end{equation}
\begin{equation}\label{cosHb}
\cos(\pi-\alpha)=\cos\pi\cos\alpha+\sin\pi\sin\alpha=-\cos\alpha=-\frac{1}{\sqrt{5}}
\end{equation}


Using Eqs.~(\ref{sinH}), and (\ref{cosH}) in Eq.~(\ref{bbr}):
% $$B_r^{top}=\frac{\muo I 2}{2a\sqrt{5}}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l(\cos\theta)$$
% So,
\begin{equation}\label{bbrH}
B_r^{top}=\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l(\cos\theta)
\end{equation}

Using Eqs.~(\ref{sinHb}), and (\ref{cosHb}) in Eq.~(\ref{bbr}):
\begin{equation}\label{bbrHb}
B_r^{bottom}=\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(-\frac{1}{\sqrt{5}}\right) P_l(\cos\theta)
\end{equation}

\begin{equation}\label{brtot}
B_r=B_r^{top}+B_r^{bottom}
\end{equation}

\begin{multline}\label{brtot_1}
    B_r=\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l(\cos\theta) \\+\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(-\frac{1}{\sqrt{5}}\right) P_l(\cos\theta)
\end{multline}


\begin{equation}\label{leg}
P_l^1(-u)=(-1)^{l+1}P_l^1(u)
\end{equation}

From Eq.~(\ref{leg}) we get that only the odd n terms contribute to net field of Eq.~(\ref{brtot_1}). Furthermore, since \(P_3^1\left(\pm\frac{1}{\sqrt{5}}\right)\) is uniquely zero â€“ thereby eliminating the n = 3.

\begin{equation}\label{brtotf}
B_r=\frac{2 \muo I }{\sqrt{5}a}\sum_{n=1,5,7,...}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l(\cos\theta)
\end{equation}

Similarly, using Eqs.~(\ref{sinH}) and (\ref{cosH}) in Eq.~\ref{bbt}) :
% $$B_\theta^{top}=-\frac{\muo I 2}{2a\sqrt{5}}\sum_{n=1}^{\infty} \frac{1}{n}\left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l^1(\cos\theta)$$
% So,
\begin{equation}\label{bbtH}
B_\theta^{top}=-\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty}\frac{1}{n} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l^1(\cos\theta)
\end{equation}

Again, using Eqs.~(\ref{sinHb}) and (\ref{cosHb}) in Eq.~\ref{bbt}) :
\begin{equation}\label{bbtHb}
B_\theta^{bottom}=-\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty}\frac{1}{n} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l^1(\cos\theta)
\end{equation}

\begin{equation}\label{bttot}
B_\theta=B_\theta^{top}+B_\theta^{bottom}
\end{equation}

\begin{multline}\label{bttot_1}
    B_\theta=-\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty}\frac{1}{n} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l^1(\cos\theta) \\-\frac{\muo I }{\sqrt{5}a}\sum_{n=1}^{\infty}\frac{1}{n} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l^1(\cos\theta)
\end{multline}


As discussed above, Eq.~(\ref{bttot_1}) will be reduced to -
\begin{equation}\label{brtotf}
B_\theta=-\frac{2 \muo I }{\sqrt{5}a}\sum_{n=1,5,7,...}^{\infty}
\frac{1}{n}\left(\frac{r}{a}\right)^{l-1}P_l^1\left(\frac{1}{\sqrt{5}}\right) P_l^1(\cos\theta)
\end{equation}



Now again for Anti-Helmholtz coils of radius \(r_c\) located at \(z=\pm z_o\) i.e. for two loops at \(\theta=\alpha, \pi-\alpha \), \(I_2=-I_1=I\) and \(z_o=\sqrt{3}\frac{r_c}{2}\),
\begin{equation}\label{sinAH}
\sin\alpha=\frac{r_c}{a}=\frac{r_c}{\sqrt{z_o^2+r_c^2}}=\frac{r_c}{\sqrt{\left(\frac{\sqrt{3}r_c}{2}\right)^2+r_c^2}}=\frac{r_c}{\sqrt{\frac{7r_c^2}{4}}}=\frac{2}{\sqrt{7}}
\end{equation}
\begin{equation}\label{sinAHb}
\sin(\pi-\alpha)=\sin\pi\cos\alpha-\cos\pi\sin\alpha=\sin\alpha=\frac{2}{\sqrt{7}}
\end{equation}
\begin{equation}\label{cosAH}
\cos\alpha=\frac{z_o}{a}=\frac{\sqrt{3}r_c}{2\sqrt{z_o^2+r_c^2}}=\frac{\sqrt{3}r_c}{2\sqrt{\left(\frac{\sqrt{3}r_c}{2}\right)^2+r_c^2}}=\frac{\sqrt{3}r_c}{2\sqrt{\frac{7r_c^2}{4}}}=\sqrt{\frac{3}{7}}
\end{equation}
\begin{equation}\label{cosAHb}
\cos(\pi-\alpha)=\cos\pi\cos\alpha+\sin\pi\sin\alpha=-\cos\alpha=-\sqrt{\frac{3}{7}}
\end{equation}

Using Eqs.~(\ref{sinAH}) and (\ref{cosAH}) in Eq.~(\ref{bbr}) :
% $$B_{r(anti)}^{top}=\frac{\muo (-I) 2}{2a\sqrt{7}}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l(\cos\theta)$$
% So,
\begin{equation}\label{bbrAH}
B_{r(anti)}^{top}=-\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l(\cos\theta)
\end{equation}

Using Eqs.~(\ref{sinAHb}) and (\ref{cosAHb}) in Eq.~(\ref{bbr}) :
\begin{equation}\label{bbrAHb}
B_{r(anti)}^{bottom}=\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(-\sqrt{\frac{3}{7}}\right) P_l(\cos\theta)
\end{equation}

$$B_{r(anti)}=B_{r(anti)}^{top}+B_{r(anti)}^{bottom}$$

\begin{multline}\label{brtotAH_1}
    B_{r(anti)}=-\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l(\cos\theta) \\+\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(-\sqrt{\frac{3}{7}}\right) P_l(\cos\theta)
\end{multline}

From Eq.~(\ref{leg}) we get that only the even n terms contribute to net field of Eq.~(\ref{brtotAH_1}). So, we get,
\begin{equation}\label{brtotAH}
B_{r(anti)}=-\frac{2 \muo I }{\sqrt{7}a}\sum_{n=2,4,6,...}^{\infty}
\left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l(\cos\theta)
\end{equation}


Similarly, using Eqs.~(\ref{sinAH}) and (\ref{cosAH}) in Eq.~(\ref{bbt}) :
% $$B_{\theta(anti)}^{top}=-\frac{\muo (-I) 2}{2a\sqrt{7}}\sum_{n=1}^{\infty} \frac{1}{n}\left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l^1(\cos\theta)$$
% So,
\begin{equation}\label{bbtAH}
B_{\theta(anti)}^{top}=\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty} \frac{1}{n}\left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l^1(\cos\theta)
\end{equation}

Using Eqs.~(\ref{sinAHb}) and (\ref{cosAHb}) in Eq.~(\ref{bbt}) :
\begin{equation}\label{bbtAHb}
B_{\theta(anti)}^{bottom}=-\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty}\frac{1}{n} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(-\sqrt{\frac{3}{7}}\right) P_l^1(\cos\theta)
\end{equation}


$$B_{\theta(anti)}=B_{\theta(anti)}^{top}+B_{\theta(anti)}^{bottom}$$

\begin{multline}\label{bttotAH_1}
    B_{\theta(anti)}=\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty} \frac{1}{n}\left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l^1(\cos\theta) \\-\frac{\muo I }{\sqrt{7}a}\sum_{n=1}^{\infty}\frac{1}{n} \left(\frac{r}{a}\right)^{l-1}P_l^1\left(-\sqrt{\frac{3}{7}}\right) P_l^1(\cos\theta)
\end{multline}


As discussed above, Eq.~(\ref{bttotAH_1}) will be reduced to -
\begin{equation}\label{bttotAH}
B_{\theta(anti)}=\frac{2 \muo I }{\sqrt{7}a}\sum_{n=2,4,6,...}^{\infty}
\frac{1}{n}\left(\frac{r}{a}\right)^{l-1}P_l^1\left(\sqrt{\frac{3}{7}}\right) P_l^1(\cos\theta)
\end{equation}